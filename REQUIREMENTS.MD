本项目要实现的是一个规则引擎。

# 基本思路

把规则变成数据和单元函数的集合，程序内写好每个单元计算的函数，比如比大小、字符串操作等。然后通过数据表结构配置规则，每条规则可以包含多个单元计算，不同单元间用且逻辑，每条规则间用或逻辑。每条规则都是一个 json 类似如下结构：

```json
{
    "$form_id": "form1"
    "$and": [
        {
             "key": "district",
             "op": "$in",
             "value": ["CHN", "HKG"]
        },
        {
            "key": "age",
            "op": "$gt",
            "value": 18
        },
        {
            "key": "name",
            "op": "$contain",
            "value": "?"
        },
        {
            "key": "detail",
            "op": "$eq",
            "value": ""
        },
        {
            "key": "content",
            "op": "$start_with",
            "value": "G"
        }
   ],
    "$result": "01/02/03/04",
    "$enabled": true
}
```

其中，`form`表示给哪个表单用，每个`key`表示需要程序传入的字段，`op`表示调用的程序内置函数，这些函数只能返回`true`或`false`，`enabled`表示本条规则是否启用。`result`表示如果上面的条件综合后为`true`的话程序需要进行的下一步操作，共有 4 个值：

- 01 - 弹框提示是否提交
- 02 - 弹框提示是否异常提交
- 03 - 强制异常提交
- 04 - 强制锁屏

每条规则在一次执行中只能返回true或者false。

程序中内置判别函数列表（暂定）：

1. 某数据项等于
2. 某数据项不等于
3. 某数据项属于
4. 某数据项不属于
5. 某数据项大于
6. 某数据项小于
7. 某数据项字符串包含某字符串
8. 某数据项字符串包含某字符串
9. 某数据项是否为空（为空字符串）
10. 某数据项字符串长度满足某个条件（大于、小于、等于、不等于，长度参数可传）

整个程序包含以下部分：

- 程序表单界面（多个，通过侧边栏选择）
- 规则存储（在内存中全局存在供其他模块使用）
- 规则配置界面（选取字段、选择函数、选择命中结果，选择是否启用，其实就是对规则的增删改查）
- 规则校验模块，负责获取本表单对应的已启用规则，将本表单字段与规则中的字段和函数放到一起进行运算。如果规则执行结果为true，则获取规则对应的`result`并在界面上显示。

